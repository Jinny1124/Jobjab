<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProfileEnt - JobJab</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Encode+Sans:wght@500;700;800&family=Carlito:wght@700&display=swap"
      rel="stylesheet">
    <link rel="stylesheet" href="../src/assets/styles/profile_ent.css">
</head>

<body>
<!-- NavBar -->
<div class="navbar">
    <div class="nav-left">
        
        <a href="../components/4inhomepage.html" class="back-arrow">&#10094;</a>
        <div class="nav-logo">JobJab</div>
    </div>
    <div class="nav-user">
        <div class="nav-actions">
            <button class="add-job-btn" onclick="window.location.href='../components/Job_detail.html'">
              <span class="plus">+</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô
            </button>
            <img src="../src/assets/Images/person-circle.png" alt="User" class="nav-avatar" />
          </div>
          
    </div>
</div>
    
<!-- Information Section -->
    <section class="info-section">
        <h1>Information</h1>
        <div class="info-card">
            <div class="info-columns">
              <div class="personal-info" id="personal-info">
                <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• -->
              </div>
              <div class="company-info" id="company-info">
                <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó -->
              </div>
            </div>
            <div class="profile-info">
              <div class="profile-pic" id="profile-pic"></div>
              <button class="edit-btn" onclick="window.location.href='../components/5accemployer.html'">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
          </div>
          
    </section>
  
<section class="job-history-section">
    <div class="job-history-header">
        <h1>Job Posting History</h1>
        <input type="text" class="search-box" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">
    </div>
    
    <div class="history-container">
        <!-- Job cards will be dynamically added here -->
    </div>
</section>

<!-- Footer Section -->
<footer style="text-align: center; margin: 40px auto; display: flex; justify-content: center;">
    <button 
        onclick="resetJobList()" 
        style="padding: 10px 20px; font-size: 1rem; background-color: #665F5F; color: white; border: none; border-radius: 8px; cursor: pointer;">
        üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô
    </button>
</footer>

<script>
// Retrieve profile data from localStorage
const profile = JSON.parse(localStorage.getItem("employer-profile") || "{}");

document.getElementById("personal-info").innerHTML = `
  <p><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</strong></p>
  <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${profile.prefix || ""} ${profile.full_name || "-"}</p>
  <p><strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:</strong> ${profile.id_number || "-"}</p>
  <p><strong>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î:</strong> ${profile.birth_date || "-"}</p>
  <p><strong>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> ${profile.phone_number || "-"}</p>
  <p><strong>Email:</strong> ${profile.email || "-"}</p>
`;

document.getElementById("company-info").innerHTML = `
  <p><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</strong></p>
  <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</strong> ${profile.company_name || "-"}</p>
  <p><strong>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:</strong> ${profile.company_description || "-"}</p>
`;

const pic = profile.profile_image || "";
if (pic) {
  const picContainer = document.getElementById("profile-pic");
  picContainer.style.background = "none";
  picContainer.innerHTML = `<img src="${pic}" style="width: 100%; height: 100%; object-fit: cover;" />`;
}

// Retrieve job data from localStorage
const jobs = JSON.parse(localStorage.getItem("jobList") || "[]");

// Get the history container element
const historyContainer = document.querySelector(".history-container");

// Clear the container
historyContainer.innerHTML = "";

// Loop through the jobs and create job cards
jobs.forEach((job, index) => {
    if (!job || !job.jobname) {
        console.warn(`Skipping invalid job at index ${index}:`, job);
        return;
    }

    const jobCard = document.createElement("div");
    jobCard.className = "job-card";

    jobCard.innerHTML = `
        <div class="job-details">
            <h3>${job.jobname}</h3>
            <p class="job-description">${job.job_description}</p>
            <div class="tags">
                <span class="tag">${job.tag}</span>
            </div>
        </div>
        <span class="status ${job.status === "open" ? "open" : "closed"}">
            ${job.status === "open" ? "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£" : "‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£"}
        </span>
        <div class="preview-pic">
            <img src="${job.image || 'default-image.jpg'}" class="card-img-top" alt="${job.jobname}">
        </div>
        <button class="view-btn" onclick='viewJobStatus(${index})'>‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
    `;

    historyContainer.appendChild(jobCard);
});

// Function to view job status
function viewJobStatus(index) {
    // Retrieve the job list from localStorage
    const jobs = JSON.parse(localStorage.getItem("jobList") || "[]");

    // Log the index and job list for debugging
    console.log("Index:", index);
    console.log("Job List:", jobs);

    // Get the selected job
    const selectedJob = jobs[index];

    // Log the selected job for debugging
    console.log("Selected Job:", selectedJob);

    // Save the selected job to localStorage
    localStorage.setItem("selectedJob", JSON.stringify(selectedJob));

    // Redirect to job-app-status.html
    window.location.href = "../components/job-app-status.html";
}

// Function to reset job list
function resetJobList() {
    const confirmReset = confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?");
    if (confirmReset) {
        // Remove job list from localStorage
        localStorage.removeItem("jobList");

        // Remove applied jobs from localStorage
        localStorage.removeItem("appliedJobs");

        // Clear the job history container
        const historyContainer = document.querySelector(".history-container");
        historyContainer.innerHTML = "<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô</p>";

        alert("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    }
}

</script>  
</body>

</html>